flowchart TD
    %% Client Applications Group
    subgraph CLIENT["Client Applications"]
        A[Expo App<br/>iOS/Android] 
        W[Next.js Web App]
    end
    
    %% Backend Services Group
    subgraph BACKEND["Backend Services"]
        S[(Supabase<br/>Backend)]
        EF[Edge Functions<br/>ai-analyze-video, tts]
    end
    
    %% Storage Systems Group
    subgraph STORAGE["Storage Systems"]
        ST[(Supabase Storage<br/>raw/processed)]
        DB[(PostgreSQL<br/>Database)]
    end
    
    %% AI Providers Group
    subgraph AI_PROVIDERS["AI Providers"]
        AI[AI Providers<br/>Pose/ASR/LLM/TTS]
    end
    
    %% Client to Supabase connections
    A -->|TanStack Query<br/>Auth| S
    W -->|TanStack Query<br/>Auth| S
    
    %% Upload flows
    A -->|Upload| ST
    W -->|Upload| ST
    
    %% Analysis invocation
    A -->|Invoke| EF
    W -->|Invoke| EF
    
    %% Edge Function operations
    EF -->|Read/Write| ST
    EF -->|Read/Write| DB
    EF -->|Call| AI
    
    %% Realtime subscriptions
    DB -->|Realtime| A
    DB -->|Realtime| W
    
    %% Styling
    classDef client fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef backend fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef storage fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef ai fill:#fff3e0,stroke:#e65100,stroke-width:2px
    
    class A,W client
    class S,EF backend
    class ST,DB storage
    class AI ai
