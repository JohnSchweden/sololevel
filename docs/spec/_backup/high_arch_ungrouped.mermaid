flowchart TD
    %% Client Applications
    A[Expo App<br/>iOS/Android] 
    W[Next.js Web App]
    
    %% Supabase Backend
    S[(Supabase<br/>Backend)]
    ST[(Supabase Storage<br/>raw/processed)]
    DB[(PostgreSQL<br/>Database)]
    EF[Edge Functions<br/>ai-analyze-video, tts]
    
    %% AI Providers
    AI[AI Providers<br/>Pose/ASR/LLM/TTS]
    
    %% Client to Supabase connections
    A -->|TanStack Query<br/>Auth| S
    W -->|TanStack Query<br/>Auth| S
    
    %% Upload flows
    A -->|Upload| ST
    W -->|Upload| ST
    
    %% Analysis invocation
    A -->|Invoke| EF
    W -->|Invoke| EF
    
    %% Edge Function operations
    EF -->|Read/Write| ST
    EF -->|Read/Write| DB
    EF -->|Call| AI
    
    %% Realtime subscriptions
    DB -->|Realtime| A
    DB -->|Realtime| W
    
    %% Styling
    classDef client fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef backend fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef storage fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef ai fill:#fff3e0,stroke:#e65100,stroke-width:2px
    
    class A,W client
    class S,EF backend
    class ST,DB storage
    class AI ai
