flowchart TD
    %% Entry Point Section
    subgraph EntryPoint ["🚀 Entry Point"]
        A[App Launch]
    end

    %% Main Screen Section
    subgraph MainScreen ["📱 Main Screen"]
        B[Main Screen - Camera View]
    end

    %% Entry flow
    A --> B

    %% Main Screen Actions
    B --> C[Side Sheet]
    B --> E[Coach Tab]
    B --> F[Native Media Picker]
    B --> G[Start Recording]
    B --> H[Insights Tab]
    B --> F4[Upload Video]
    B --> G0E[Camera Swap Control]
    B --> G0[Notifications Menu]

    %% Side Sheet Section
    subgraph SideSheet ["📋 Side Sheet"]
        C[Side Sheet]

        subgraph Videos ["🎥 Videos"]
            C1[Videos List Screen]
            C4[Filter Screen]
            C5[Select Video from List]
            C6[Video Detail View]
            C7[Playback with Feedback]
            C8[View AI Insights]
        end

        subgraph Settings ["⚙️ Settings"]
            C3[Settings Screen]
            C9[Account Settings]
            C10[Personalisation]
            C11[Give Feedback]
            C12[Data Controls]
            C13[Security]
            C14[About]
            C15[Log Out]
        end
    end

    %% Notifications Section
    subgraph Notifications ["🔔 Notifications"]
        G0[Notifications Menu]
        G0A[View Notifications]
        G0B[Mark as Read]
        G0C[Clear All]
        G0D[Notification Settings]
    end

    %% Side Sheet Flow
    C --> C1
    C --> C3
    C1 --> C
    C3 --> B

    %% Videos List Screen Actions
    C1 --> C4
    C1 --> C5
    C4 --> C1

    %% Video Detail Flow
    C5 --> C6
    C6 --> C7
    C7 --> C8
    C8 --> C6
    C6 --> C1

    %% Settings Screen Actions
    C3 --> C9
    C3 --> C10
    C3 --> C11
    C3 --> C12
    C3 --> C13
    C3 --> C14
    C3 --> C15
    C9 --> C3
    C10 --> C3
    C11 --> C3
    C12 --> C3
    C13 --> C3
    C14 --> C3

    %% Notifications Flow
    G0 --> G0A
    G0 --> G0B
    G0 --> G0C
    G0 --> G0D
    G0A --> G0
    G0B --> G0
    G0C --> G0
    G0D --> G0
    G0 --> B

    %% Recording & Upload Section
    subgraph RecordingUpload ["🎥 Recording & Upload"]
        F4[Upload Video]
        G0E[Camera Swap Control]
        F[Native Media Picker]
        F1[Select Video]
        F2[Select File]
        F3[Cancel]
        G[Start Recording]
        G1[Recording Active State]
        G1A[Zoom In]
        G1B[Zoom Out]
        G2[Pause Recording]
        G3[Stop Recording]
        G4[Resume Recording]
        G5[Analysis Processing]
    end

    %% Camera Controls Flow
    F4 --> F
    G0E --> B

    %% Recording Flow - Active State
    G --> G1
    G1 --> G1A
    G1 --> G1B
    G1A --> G1
    G1B --> G1
    G1 --> G2
    G1 --> G3
    G2 --> G4
    G2 --> G3
    G4 --> G1
    G3 --> G5

    %% Upload Video Flow
    F --> F1
    F --> F2
    F --> F3
    F1 --> G5
    F2 --> G5
    F3 --> B

    %% Analysis Section
    subgraph Analysis ["🧠 Analysis"]
        G5[Analysis Processing]
        G6[AI Processing with Spinner]
        G5A[Cancel Analysis]
        G7[Feedback Review Screen]
    end

    %% Analysis Flow
    G5 --> G6
    G5 --> G5A
    G6 --> G7
    G5A --> B

    %% Feedback Review Section
    subgraph FeedbackReview ["🎬 Feedback Review"]
        G7[Feedback Review Screen]
        G8[Video Playback with Overlay]
        G9[View AI Feedback Timeline]
        G10[View Performance Insights]
        G8A[Motion Capture Overlay Active]
        G8B[Feedback Bubbles Display]
        G8C[Audio Commentary Playback]
        A1[Audio Feedback Available]
        A2[Audio Controls Play/Pause/Seek]
        A3[Audio End Auto-Resume Video]
        G11[Play/Pause Controls]
        G12[Seek Timeline]
        G11A[Video Playing State]
        G11B[Video Paused State]
        G9A[Feedback Tab Active]
        G9B[Insights Tab Active]
        G9C[Comments Tab Active]
        G9D[Bottom Sheet Expanded 40% Height]
        G9E[Bottom Sheet Collapsed]
        P1[Open Feedback Panel Bottom Sheet]
        P2[Panel Expands Video Resizes]
        P3[Draggable Progress Scrubber]
    end

    %% Feedback Review Flow
    G7 --> G8
    G7 --> G9
    G7 --> G10

    %% Video Playback Sub-states
    G8 --> G8A
    G8 --> G8B
    G8 --> G8C
    G8 --> A1
    A1 --> A2
    A2 --> A3
    G8A --> G8
    G8B --> G8
    G8C --> G8

    %% Video Controls Sub-states
    G8 --> G11
    G8 --> G12
    G11 --> G11A
    G11 --> G11B
    G11A --> G8
    G11B --> G8
    G12 --> G8

    %% Bottom Sheet Sub-states
    G9 --> G9A
    G9 --> G9B
    G9 --> G9C
    G9 --> G9D
    G9 --> G9E
    G7 --> P1
    P1 --> P2
    P2 --> P3
    G9A --> G9
    G9B --> G9
    G9C --> G9
    G9D --> G9E
    G9E --> G9D

    %% Navigation between main states
    G9 --> G7
    G10 --> G7
    G8 --> G7

    %% Coach Section
    subgraph Coach ["🏆 Coach"]
        E[Coach Tab]
        E1[Chat Mode]
        E2[Mirror Mode]
        E3[Type Message]
        E4[Send Message]
        E5[Receive Avatar Response]
    end

    %% Insights Section
    subgraph Insights ["📊 Insights"]
        H[Insights Tab]
        H1[View Performance Score]
        H2[View Radar Chart]
        H3[View Category Breakdown]
        H4[View Detailed Feedback]
        H5[View Action Plan]
    end

    %% Coach Tab Flow
    E --> E1
    E --> E2
    E1 --> E3
    E3 --> E4
    E4 --> E5
    E5 --> E3
    E1 --> E
    E2 --> E

    %% Insights Tab Flow
    H --> H1
    H --> H2
    H --> H3
    H --> H4
    H --> H5
    H1 --> H
    H2 --> H
    H3 --> H
    H4 --> H
    H5 --> H

    %% Navigation Back to Main
    E --> B
    G7 --> B
    H --> B
    
    %% Styling Classes
    classDef entryPoint fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef mainScreen fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef sideSheet fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef recording fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef analysis fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    classDef feedback fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef coach fill:#fce4ec,stroke:#ad1457,stroke-width:2px
    classDef insights fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef settings fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef notifications fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    classDef cameraControls fill:#f1f8e9,stroke:#558b2f,stroke-width:2px
    
    %% Apply Classes
    class A entryPoint
    class B mainScreen
    class C,C1,C4,C5,C6,C7,C8 sideSheet
    class G5,G5A,G6 analysis
    class G7,G8,G8A,G8B,G8C,G9,G9A,G9B,G9C,G9D,G9E,G10,G11,G11A,G11B,G12 feedback
    class A1,A2,A3,P1,P2,P3 recording
    class E,E1,E2,E3,E4,E5 coach
    class H,H1,H2,H3,H4,H5 insights
    class C3,C9,C10,C11,C12,C13,C14,C15 settings
    class G0,G0A,G0B,G0C,G0D notifications
    class G0E,F,F1,F2,F3,F4,G,G1,G1A,G1B,G2,G3,G4 cameraControls