graph TD
  %% UI Component Hierarchy
  subgraph "RecordScreen UI"
    RecordScreen --> TopBar
    RecordScreen --> CameraPreview
    CameraPreview --> MotionOverlay
    CameraPreview --> RecordingTimer
    RecordScreen --> ControlsBar
    ControlsBar --> RecordBtn["Record/Pause/Stop"]
    ControlsBar --> UploadBtn["Upload Video"]
    ControlsBar --> SwapBtn["Camera Swap"]
    ControlsBar --> ZoomSegmented
    ControlsBar --> SettingsBtn
    RecordScreen --> BottomTabs
    RecordScreen --> PermissionDialog
    RecordScreen --> LibrarySideSheet
  end

  %% System Data Flow
  subgraph "Backend Flow"
    UploadStep["1. Upload to Storage `raw`"] --> EdgeFn["2. Edge Function `ai-analyze-video`"]
    EdgeFn --> DBAnalyses["3. Insert into `analyses` table"]
    EdgeFn --> StorageProcessed["3. Store artifacts in `processed`"]
    DBAnalyses --> Realtime["4. Supabase Realtime"]
    Realtime --> ClientStatus["5. UI updates status/progress"]
  end

  %% Integrations
  UploadBtn -- triggers --> UploadStep
  RecordBtn -- when Stop --> UploadStep
  ClientStatus -- navigates --> AnalysisScreen["Analysis / Progress Screen"]
