graph TB
    %% User Layer
    subgraph "👤 Users"
        User[👤 End User<br/>iOS/Android/Web]
    end

    %% Client Applications Layer
    subgraph "📱 Client Applications"
        subgraph "Expo App<br/>(React Native)"
            ExpoApp[📱 Expo App<br/>iOS/Android]
            ExpoRouter[🏗️ Expo Router<br/>File-based Routing]
            VisionCam[📷 Vision Camera<br/>Native Camera]
        end

        subgraph "Next.js App<br/>(Web)"
            NextApp[🌐 Next.js App<br/>SSR/SSG]
            NextRouter[🏗️ Next.js Router<br/>App Router]
            MediaPipe[🤖 MediaPipe<br/>Web Pose Detection]
        end
    end

    %% Shared Packages Layer
    subgraph "📦 Shared Packages"
        subgraph "@my/ui<br/>UI Components"
            Tamagui[🎨 Tamagui<br/>Cross-platform UI]
            Components[🧩 Components<br/>Buttons, Forms, Layouts]
            Theme[🎭 Theme System<br/>Design Tokens]
        end

        subgraph "@my/app<br/>Business Logic"
            Features[⚡ Features<br/>CameraRecording, Auth]
            Hooks[🪝 Custom Hooks<br/>useCamera, usePose]
            Stores[🏪 Zustand Stores<br/>State Management]
            Validation[✅ Validation<br/>Zod Schemas]
        end

        subgraph "@my/api<br/>Backend Client"
            SupabaseClient[🔗 Supabase Client<br/>Typed API Client]
            TanStackQuery[🔄 TanStack Query<br/>Data Fetching]
            Realtime[📡 Realtime Subscriptions<br/>Live Updates]
        end
    end

    %% Backend Layer
    subgraph "☁️ Supabase Backend"
        subgraph "Database Layer"
            PostgreSQL[(🗄️ PostgreSQL<br/>Primary Database)]
            RLS[🔐 Row Level Security<br/>Data Access Control]
            RealtimeDB[📡 Realtime<br/>Live Queries]
        end

        subgraph "Storage Layer"
            SupabaseStorage[📁 File Storage<br/>Videos, Audio, Assets]
            CDN[🌐 CDN<br/>Global Delivery]
        end

        subgraph "Edge Functions"
            AIFunctions[🤖 AI Functions<br/>Video Analysis Pipeline]
            AuthFunctions[🔐 Auth Functions<br/>Custom Auth Logic]
            ProcessingFunctions[⚙️ Processing Functions<br/>Media Processing]
        end

        subgraph "Auth Layer"
            SupabaseAuth[🔑 Supabase Auth<br/>JWT Authentication]
            UserManagement[👥 User Management<br/>Profiles & Sessions]
        end
    end

    %% AI Services Layer
    subgraph "🧠 AI Services"
        subgraph "Pose Detection"
            TensorFlow[🤖 TensorFlow.js<br/>Web Processing]
            VisionCameraAI[📷 Vision Camera<br/>Native Processing]
            MediaPipeWeb[🎯 MediaPipe<br/>Web Implementation]
        end

        subgraph "Voice Analysis"
            WebAudioAPI[🎤 Web Audio API<br/>Web Recording]
            ExpoAV[🎵 Expo AV<br/>Native Audio]
            VoiceProcessing[🎙️ Voice Processing<br/>Edge Functions]
        end

        subgraph "AI Feedback"
            LLMService[💭 LLM Service<br/>Text Generation]
            TTSService[🔊 Text-to-Speech<br/>Audio Generation]
            FeedbackEngine[💬 Feedback Engine<br/>Structured Analysis]
        end
    end

    %% Development & Build Tools
    subgraph "🛠️ Development Tools"
        subgraph "Build System"
            Turbo[⚡ Turbo<br/>Build Orchestration]
            Yarn4[🧶 Yarn 4<br/>Workspace Management]
            TypeScript[📝 TypeScript<br/>Type Safety]
        end

        subgraph "Quality Gates"
            Biome[✨ Biome<br/>Linting/Formatting]
            Vitest[🧪 Vitest<br/>Unit Testing]
            Playwright[🎭 Playwright<br/>E2E Testing]
        end

        subgraph "CI/CD"
            GitHubActions[⚙️ GitHub Actions<br/>CI Pipeline]
            EAS[📦 Expo Application Services<br/>Native Builds]
            Vercel[▲ Vercel<br/>Web Deployment]
        end
    end

    %% Data Flow Connections
    User --> ExpoApp
    User --> NextApp

    ExpoApp --> ExpoRouter
    NextApp --> NextRouter

    ExpoApp --> VisionCam
    NextApp --> MediaPipe

    ExpoApp --> Tamagui
    NextApp --> Tamagui

    Tamagui --> Components
    Tamagui --> Theme

    ExpoApp --> Features
    NextApp --> Features

    Features --> Hooks
    Features --> Stores
    Features --> Validation

    Features --> SupabaseClient
    Hooks --> SupabaseClient
    Stores --> SupabaseClient

    SupabaseClient --> TanStackQuery
    SupabaseClient --> Realtime

    TanStackQuery --> PostgreSQL
    Realtime --> RealtimeDB

    SupabaseClient --> SupabaseStorage
    SupabaseStorage --> CDN

    Features --> AIFunctions
    AIFunctions --> PoseDetection
    AIFunctions --> VoiceProcessing
    AIFunctions --> FeedbackEngine

    PoseDetection --> TensorFlow
    PoseDetection --> VisionCameraAI
    PoseDetection --> MediaPipeWeb

    VoiceProcessing --> WebAudioAPI
    VoiceProcessing --> ExpoAV

    FeedbackEngine --> LLMService
    FeedbackEngine --> TTSService

    AIFunctions --> PostgreSQL
    AIFunctions --> SupabaseStorage

    SupabaseAuth --> UserManagement
    SupabaseAuth --> PostgreSQL

    Features --> SupabaseAuth

    %% Development Flow
    Turbo --> ExpoApp
    Turbo --> NextApp
    Turbo --> Tamagui
    Turbo --> Features
    Turbo --> SupabaseClient

    Yarn4 --> Turbo
    Yarn4 --> Biome
    Yarn4 --> Vitest
    Yarn4 --> Playwright

    GitHubActions --> Yarn4
    EAS --> ExpoApp
    Vercel --> NextApp

    TypeScript --> ExpoApp
    TypeScript --> NextApp
    TypeScript --> Tamagui
    TypeScript --> Features
    TypeScript --> SupabaseClient

    %% Styling
    classDef userLayer fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    classDef clientLayer fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef sharedLayer fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef backendLayer fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef aiLayer fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef devLayer fill:#e0f2f1,stroke:#00695c,stroke-width:2px

    class User userLayer
    class ExpoApp,NextApp,ExpoRouter,NextRouter,VisionCam,MediaPipe clientLayer
    class Tamagui,Components,Theme,Features,Hooks,Stores,Validation,SupabaseClient,TanStackQuery,Realtime sharedLayer
    class PostgreSQL,RLS,RealtimeDB,SupabaseStorage,CDN,AIFunctions,AuthFunctions,ProcessingFunctions,SupabaseAuth,UserManagement backendLayer
    class TensorFlow,VisionCameraAI,MediaPipeWeb,WebAudioAPI,ExpoAV,VoiceProcessing,LLMService,TTSService,FeedbackEngine aiLayer
    class Turbo,Yarn4,TypeScript,Biome,Vitest,Playwright,GitHubActions,EAS,Vercel devLayer

    %% Legend
    subgraph "📊 Legend"
        direction LR
        UserLegend[👤 User Layer]:::userLayer
        ClientLegend[📱 Client Apps]:::clientLayer
        SharedLegend[📦 Shared Code]:::sharedLayer
        BackendLegend[☁️ Backend]:::backendLayer
        AILegend[🧠 AI Services]:::aiLayer
        DevLegend[🛠️ Dev Tools]:::devLayer
    end
